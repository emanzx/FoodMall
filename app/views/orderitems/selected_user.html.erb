<p id="notice"><%= notice %></p>

<h2>Record for <%= @users.find(@display.to_i).username %></h2><br>

<% if @users.find(@display.to_i).role == "customer" %>
<center><h4>Active Order</h4></center>
<%= form_tag('/edit_cust_order', method: :post) %>
<table class="table">
  <thead>
    <tr class="danger">
      <th></th>
      <th><%= sort_link @search, :item_name, "Item" %></th>
      <th>Quantity</th>
      <th><%= sort_link @search, :customer_username, "Customer" %></th>
      <th>Runner</th>
      <th>Chef</th>
      <th><%= sort_link @search, :status, "Status" %></th>
      <th><%= sort_link @search, :dtime, "Date" %></th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>

    <% @orderitems.each do |orderitem| %>
      <% if orderitem.user_id.to_s == @display.to_s && orderitem.status != "pre-order" && orderitem.status != "complete" %>
      <tr>
        <td><%= check_box_tag "orderitem_ids[]", orderitem.id %></td>
        <td><%= orderitem.item.name %></td>
        <td><%= orderitem.quantity %></td>
        <td><%= orderitem.user.username %></td>
        <% unless orderitem.runner_id.nil? %>
          <td><%= @users.find(orderitem.runner_id).username %></td>
          <td><%= @users.find(orderitem.chef_id).username %></td>
        <% else %>
          <td><%= orderitem.runner_id %></td>
          <td><%= orderitem.chef_id %></td>
        <% end -%>
        <td><%= orderitem.status %></td>
        <td><%= orderitem.dtime %></td>
        <td><%= link_to '', orderitem, class: 'glyphicon glyphicon-eye-open' %></td>
        <td><%= link_to '', edit_orderitem_path(orderitem), class: 'glyphicon glyphicon-pencil' %></td>
        <td><%= link_to '', orderitem, method: :delete, data: { confirm: 'Are you sure?' }, class: 'glyphicon glyphicon-trash' %></td>
      </tr>
      <% end %>
    <% end %>
  </tbody>
</table>

<br>
<p align="right"><%= submit_tag "Set Runner & chef", class: "btn btn-info" %></p>

<% end -%>

<br>

<br><center><h4>All Order Items </h4></center>
<table class="table">
  <thead>
    <tr class="info">
      <th><%= sort_link @search, :item_name, "Item" %></th>
      <th>Quantity</th>
      <th><%= sort_link @search, :customer_username, "Customer" %></th>
      <th>Runner</th>
      <th>Chef</th>
      <th><%= sort_link @search, :status, "Status" %></th>
      <th><%= sort_link @search, :dtime, "Date" %></th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>

    <% @orderitems.each do |orderitem| %>
      <% if orderitem.user_id.to_s == @display.to_s && orderitem.status == "complete" %>
        <tr>
          <td><%= orderitem.item.name %></td>
          <td><%= orderitem.quantity %></td>
          <td><%= orderitem.user.username %></td>
          <% unless orderitem.runner_id.nil? %>
            <td><%= @users.find(orderitem.runner_id).username %></td>
            <td><%= @users.find(orderitem.chef_id).username %></td>
          <% else %>
            <td><%= orderitem.runner_id %></td>
            <td><%= orderitem.chef_id %></td>
          <% end -%>
          <td><%= orderitem.status %></td>
          <td><%= orderitem.dtime %></td>
          <td><%= link_to '', orderitem, class: 'glyphicon glyphicon-eye-open' %></td>
          <td><%= link_to '', orderitem, method: :delete, data: { confirm: 'Are you sure?' }, class: 'glyphicon glyphicon-trash' %></td>
        </tr>
      <% end %>

      <% if orderitem.chef_id.to_s == @display.to_s || orderitem.runner_id.to_s == @display.to_s %>
      <tr>
        <td><%= orderitem.item.name %></td>
        <td><%= orderitem.quantity %></td>
        <td><%= orderitem.user.username %></td>
        <td><%= @users.find(orderitem.runner_id).username %></td>
        <td><%= @users.find(orderitem.chef_id).username %></td>
        <td><%= orderitem.status %></td>
        <td><%= orderitem.dtime %></td>
        <td><%= link_to '', orderitem, class: 'glyphicon glyphicon-eye-open' %></td>
        <td><%= link_to '', orderitem, method: :delete, data: { confirm: 'Are you sure?' }, class: 'glyphicon glyphicon-trash' %></td>
      </tr>
      <% end %>
    <% end %>
  </tbody>
</table>
<%= will_paginate @orderitems %>

<br>
<p align="right"><%= link_to 'Back', '/view_orderitem', class: "btn btn-warning" %></p>
